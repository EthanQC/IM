# IM Web 微信风格重构 PRD（本地开发版）

## 1. 目标
- 将聊天页重构为微信桌面端风格交互，保持现有后端 API 能力不缩水。
- 消除“开发面板感”，所有能力通过产品化入口和反馈完成。
- 本地联调场景下，确保双窗口、多账号、文件/图片、语音/视频通话可用。

## 2. 设计原则
- 视觉：灰白主背景 + 微信绿强调色，弱化装饰。
- 布局：导航窄栏 + 会话列表 + 聊天主区。
- 行为：主路径高频操作可一步触达；低频功能归入更多菜单/资料抽屉。
- 反馈：所有失败必须是用户可理解中文提示，不暴露 RPC/栈信息。

## 3. 信息架构
- 左侧导航栏
  - 我的头像
  - 聊天、通讯录切换
  - 新建聊天、刷新、退出
- 会话/通讯录栏
  - 搜索
  - 会话列表（标题、时间、预览、未读数）
  - 联系人列表（在线状态、进入会话、删除）
- 聊天主区
  - 顶部：会话标题 + 更多菜单 + 会话信息
  - 消息区：文本/图片/文件/音频/视频/通话提示
  - 输入区：发送文件、语音/视频通话、粘贴图片提示、发送按钮
- 右侧信息抽屉
  - 会话信息、联系人信息、群名称编辑、连接状态

## 4. 功能需求

### 4.1 账号与会话
- 支持登录后自动初始化会话、联系人、在线状态和 WS。
- 支持新建单聊、群聊。
- 支持会话标题（群聊）更新。

### 4.2 通讯录
- 添加好友：账号(@username)/IM号。
- 处理申请：账号(@username)/IM号 + 同意/拒绝。
- 删除联系人。
- 联系人进入单聊。

### 4.3 消息
- 文本消息：Enter 发送，Shift+Enter 换行。
- 文件消息：点击上传、拖拽上传。
- 图片消息：粘贴截图直接上传发送；可点击预览。
- 撤回消息。
- 已读提示与未读角标。

### 4.4 通话（WebRTC）
- 发起语音/视频。
- 来电弹窗：接听/拒绝。
- 通话浮层：状态展示、挂断。
- 设备不可用降级：允许仅接收模式，不得直接流程中断。

### 4.5 错误与状态
- Failed to fetch、设备不存在、权限拒绝、token 失效等必须中文化。
- 上传失败必须区分签名过期/网络失败。

## 5. 联调与验收
- 双窗口（A/B）登录后，在线状态稳定，不互踢。
- A 添加 B，B 同意，双方联系人同步。
- A/B 互发文本，消息实时到达，未读/已读正常。
- A 粘贴图片发送、上传文件发送成功，B 能接收并打开。
- A 发起语音/视频，B 接听后状态正常，挂断后双方复位。
- 页面移动端宽度下可用（导航、列表、输入区不崩溃）。

## 6. 非目标
- 本次不实现朋友圈、表情商店、红包、公众号等微信扩展生态能力。
